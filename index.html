<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta http-equiv="X-UA-Compatible" content="ie=edge">
        <title>Desafio Front-end</title>
        
        <link rel="stylesheet" href="./index.css">
    </head>
    <body onload="criarLista()">
        <header>            
            <img class="imagem_header" src="img/Logo Salesoft.png" alt="Logo da Salesoft"/>
            <h1>Crie sua lista de compras!</h1>            
        </header>
        <section>
            <br/>
            <div class="row">
                <div class="col-lg-7">
                    <div class="panel panel-warning">
                        <div class="panel-heading">
                            <div class="row">
                                <div class="col-lg-10">
                                    <h3 style="padding-top: 5px" class="panel-title"><i class="glyphicon glyphicon-plus"></i>Lista de Compras <label id="qtdItens"> </label></h3>
                                </div>
                                <div class="col-lg-2">
                                    <button type="button" data-toggle="modal" data-target="#adicionarItem" class="btn btn-primary btn-sm botao"><i class="glyphicon glyphicon-plus"></i> Adicionar</button>
                                </div>
                            </div>
                        </div>
                        <div class="panel-body">
                            <div class="row">
                                <div class="col-lg-12">
                                    <table id="tabelaItens" class="table table-hover">

                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-5">
                    <div class="panel panel-success">
                        <div class="panel-heading">
                            <h3 class="panel-title"><i class="glyphicon glyphicon-plus"></i> Itens Comprados</h3>
                        </div>
                        <div class="panel-body">
                            <div class="flot-chart">
                                <div class="flot-chart-content" id="flot-line-chart"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        <script src="./index.js"></script>
        <script src="./jquery.validate.js"></script>

        <footer>
            <div class="row">
                <div class="col-lg-12">
                    <center><p>Copyright &copy; | Sofia Trindade - 2018</p></center>
                </div>
            </div>
        </footer>

        <div class="modal fade" id="adicionarItem" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" onclick="limparForm()" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                        <h4 class="modal-title" id="myModalLabel">Adicionar Item de Compra&nbsp;<i class="glyphicon glyphicon-pencil"></i></h4>
                    </div>
                    <div class="modal-body">
                        <div class="btn-group btn-group-justified" role="group">
                            <div class="btn-group" role="group">

                                <div class="form-group">
                                    <form name="formAdicionarItem" id="formAdicionarItem">
                                        <input type="hidden" id="index" name="index" value=""/>
                                        <div class="col-sm-10 col-sm-offset-1">
                                            <label class="col-sm-2 control-label" for="descricao">Descrição</label>
                                            <input type="text" class="form-control" id="descricao" name="descricao" maxlength="80" placeholder="Insira uma descrição" />                                                                            
                                        </div>  
                                        <br/>
                                        <div class="col-lg-6 col-lg-offset-3">
                                            <br/>
                                            <input type="button" class="btn btn-primary" onclick="adicionarItem($('#descricao').val(), $('#index').val())" value="Salvar">                                        
                                        </div>
                                    </form>
                                </div>                                

                            </div>                           
                        </div>
                    </div>
                    <div class="modal-footer">
                        <!-- pegar operadora selecionada -->
                        <div class="col-lg-8">
                            <span class="alert-warning">                                            
                                <label style="font-size: 16px;" id="msgCampo"></label>
                            </span>
                        </div>
                        <input data-dismiss="modal" class="btn btn-sm btn-default" onclick="limparForm()" value="Fechar">
                    </div>
                </div>
            </div>
        </div>                     

        <script type="text/javascript">
            function criarLista() {
                listaItems = new Array();
                qtd = 0;
                document.getElementById('qtdItens').innerHTML="(0)";
            }
            $(document).ready(function () {
                document.getElementById('msgCampo').innerHTML = "";
                $("#formAdicionarItem").validate({
                    rules: {
                        descricao: {
                            required: true,
                            minlength: 3
                        }
                    },
                    messages: {
                        descricao: {
                            required: "Preencha este campo, por favor.",
                            minlength: "Insira no mínimo 3 caracteres."
                        }
                    },
                    errorElement: "em",
                    errorPlacement: function (error, element) {
                        // Add the `help-block` class to the error element
                        error.addClass("help-block");

                        // Add `has-feedback` class to the parent div.form-group
                        // in order to add icons to inputs
                        element.parents("").addClass("has-feedback");

                        if (element.prop("type") === "checkbox") {
                            error.insertAfter(element.parent("label"));
                        } else {
                            error.insertAfter(element);
                        }

                        // Add the span element, if doesn't exists, and apply the icon classes to it.
                        if (!element.next("span")[ 0 ]) {

                        }
                    },
                    success: function (label, element) {

                    },
                    highlight: function (element, errorClass, validClass) {
                        $(element).parents("").addClass("has-error").removeClass("has-success");

                    },
                    unhighlight: function (element, errorClass, validClass) {
                        $(element).parents("").addClass("has-success").removeClass("has-error");

                    }
                });
            });

            function limparForm() {
                document.formAdicionarItem.descricao.value = "";
                document.formAdicionarItem.index.value = "";
                document.getElementById('msgCampo').innerHTML = "";                
            }

            function mostrarItens() {
                var options = "";
                for (var i = 1; i <= qtd; i++) {
                    options += "<tr>";
                    options += "<td class='col-sm-9'>" + listaItems[i] + "</td>";
                    options += "<td class='col-sm-1'><button type='button' onclick='excluirItem(" + i + ")' class='btn btn-warning btn-sm'>Excluir</button></td>";
                    options += "<td class='col-sm-1'><button type='button' data-target='#adicionarItem' onclick='carregarItem(" + i + ")' class='btn btn-primary btn-sm'> Alterar</button></td>";
                    options += "<td class='col-sm-1'><button type='button' onclick='comprarItem(" + i + ")' class='btn btn-success btn-sm'>Comprado</button></td>";

                    options += "</tr>";
                }
                $('#tabelaItens').html(options).show();
                document.getElementById('qtdItens').innerHTML="("+qtd+")";
            }

            function adicionarItem(descricao, index) {
                if (descricao !== "") {
                    if (index === "") {
                        // novo item
                        qtd++;
                        listaItems[qtd] = descricao;
                    } else {
                        // alteração do item
                        listaItems[index] = descricao;
                    }
                    mostrarItens();
                    $('#adicionarItem').modal('toggle');
                    limparForm();
                } else {
                    document.getElementById('msgCampo').innerHTML = "O campo descrição é obrigatório!";
                }                
            }

            function excluirItem(index) {
                for (var j = index; j < qtd; j++) {
                    listaItems[j] = listaItems[j + 1];
                }
                qtd--;
                mostrarItens();                
            }

            function carregarItem(index) {
                $('#adicionarItem').modal('show');
                $('#descricao').val(listaItems[index]);
                $('#index').val(index);
            }
            
            function comprarItem(){
                
            }
        </script>
    </body>
</html>